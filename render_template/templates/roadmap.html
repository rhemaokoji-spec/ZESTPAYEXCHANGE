<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZestPay AI Assistant</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #FFD700;
            --primary-dark: #B8860B;
            --bg-primary: #0a0a0a;
            --bg-secondary: #1a1a1a;
            --bg-card: #1e1e1e;
            --text-primary: #ffffff;
            --text-secondary: #b0b0b0;
            --accent: #d4af37;
            --border: #333333;
            --shadow: rgba(0,0,0,0.4);
            --gradient: linear-gradient(135deg, #f4e4c1 0%, #b8860b 100%);
            --success: #2ed573;
            --error: #ff4757;
            --info: #3742fa;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Animated background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--gradient);
            opacity: 0.03;
            z-index: -1;
            animation: gradientShift 20s ease infinite;
        }

        @keyframes gradientShift {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.1) rotate(180deg); }
        }

        /* Header */
        .header {
            background: rgba(26, 26, 26, 0.95);
            backdrop-filter: blur(20px);
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border);
            box-shadow: 0 4px 20px var(--shadow);
            z-index: 100;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo i {
            font-size: 32px;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .logo h1 {
            font-size: 24px;
            font-weight: 700;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .header-btn {
            background: rgba(255, 215, 0, 0.1);
            border: 1px solid rgba(255, 215, 0, 0.3);
            color: var(--primary-color);
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .header-btn:hover {
            background: rgba(255, 215, 0, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.2);
        }

        /* Main container */
        .main-container {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: rgba(30, 30, 30, 0.95);
            backdrop-filter: blur(20px);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
        }

        .sidebar-header h3 {
            font-size: 18px;
            margin-bottom: 15px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sidebar-header h3 i {
            color: var(--primary-color);
        }

        .new-chat-btn {
            width: 100%;
            padding: 12px;
            background: var(--gradient);
            border: none;
            border-radius: 10px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .new-chat-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.3);
        }

        .chat-history {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
        }

        .chat-history-item {
            padding: 12px 15px;
            margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid transparent;
        }

        .chat-history-item:hover {
            background: rgba(255, 215, 0, 0.1);
            border-color: rgba(255, 215, 0, 0.3);
        }

        .chat-history-item.active {
            background: rgba(255, 215, 0, 0.15);
            border-color: var(--primary-color);
        }

        .chat-history-item-title {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .chat-history-item-date {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .chat-history-item-delete {
            float: right;
            color: var(--error);
            opacity: 0;
            transition: opacity 0.3s ease;
            cursor: pointer;
        }

        .chat-history-item:hover .chat-history-item-delete {
            opacity: 1;
        }

        /* Chat area */
        .chat-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: rgba(10, 10, 10, 0.5);
        }

        .chat-header {
            padding: 20px 30px;
            background: rgba(26, 26, 26, 0.8);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .ai-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: var(--gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: white;
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.3);
        }

        .ai-info {
            flex: 1;
        }

        .ai-name {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 3px;
        }

        .ai-status {
            font-size: 13px;
            color: var(--success);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background: var(--success);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 30px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .message {
            display: flex;
            gap: 15px;
            animation: messageSlide 0.3s ease;
        }

        @keyframes messageSlide {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            flex-shrink: 0;
        }

        .message.ai .message-avatar {
            background: var(--gradient);
            color: white;
        }

        .message.user .message-avatar {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
        }

        .message-content {
            max-width: 70%;
            padding: 15px 20px;
            border-radius: 18px;
            position: relative;
        }

        .message.ai .message-content {
            background: rgba(255, 215, 0, 0.1);
            border: 1px solid rgba(255, 215, 0, 0.2);
            border-bottom-left-radius: 5px;
        }

        .message.user .message-content {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-bottom-right-radius: 5px;
        }

        .message-text {
            font-size: 15px;
            line-height: 1.5;
            color: var(--text-primary);
            white-space: pre-wrap;
        }

        .message-time {
            font-size: 11px;
            color: var(--text-secondary);
            margin-top: 5px;
            text-align: right;
        }

        .message-actions {
            position: absolute;
            top: -30px;
            right: 10px;
            display: flex;
            gap: 10px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .message:hover .message-actions {
            opacity: 1;
        }

        .message-action {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 12px;
            color: var(--text-secondary);
        }

        .message-action:hover {
            background: rgba(255, 215, 0, 0.2);
            color: var(--primary-color);
        }

        /* Typing indicator */
        .typing-indicator {
            display: flex;
            gap: 15px;
            padding: 15px 20px;
            background: rgba(255, 215, 0, 0.1);
            border: 1px solid rgba(255, 215, 0, 0.2);
            border-radius: 18px;
            border-bottom-left-radius: 5px;
            width: fit-content;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: var(--primary-color);
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
            }
            30% {
                transform: translateY(-10px);
            }
        }

        /* Input area */
        .chat-input-container {
            padding: 20px 30px;
            background: rgba(26, 26, 26, 0.8);
            border-top: 1px solid var(--border);
        }

        .chat-input-wrapper {
            display: flex;
            gap: 15px;
            align-items: flex-end;
        }

        .chat-input {
            flex: 1;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 12px 20px;
            color: var(--text-primary);
            font-size: 15px;
            resize: none;
            max-height: 120px;
            min-height: 50px;
            transition: all 0.3s ease;
        }

        .chat-input:focus {
            outline: none;
            border-color: var(--primary-color);
            background: rgba(255, 255, 255, 0.08);
        }

        .chat-input-actions {
            display: flex;
            gap: 10px;
        }

        .input-action-btn {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--text-secondary);
        }

        .input-action-btn:hover {
            background: rgba(255, 215, 0, 0.1);
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        .send-btn {
            background: var(--gradient);
            border: none;
            color: white;
        }

        .send-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.3);
        }

        .send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Quick suggestions */
        .quick-suggestions {
            padding: 15px 30px;
            background: rgba(26, 26, 26, 0.5);
            border-top: 1px solid var(--border);
            display: flex;
            gap: 10px;
            overflow-x: auto;
        }

        .suggestion-chip {
            padding: 8px 16px;
            background: rgba(255, 215, 0, 0.1);
            border: 1px solid rgba(255, 215, 0, 0.2);
            border-radius: 20px;
            color: var(--primary-color);
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .suggestion-chip:hover {
            background: rgba(255, 215, 0, 0.2);
            transform: translateY(-2px);
        }

        /* Welcome screen */
        .welcome-screen {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
            text-align: center;
        }

        .welcome-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: var(--gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            color: white;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.3);
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .welcome-title {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 15px;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .welcome-subtitle {
            font-size: 16px;
            color: var(--text-secondary);
            margin-bottom: 40px;
            max-width: 500px;
        }

        .welcome-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            width: 100%;
            max-width: 800px;
        }

        .feature-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .feature-card:hover {
            background: rgba(255, 215, 0, 0.1);
            border-color: rgba(255, 215, 0, 0.3);
            transform: translateY(-5px);
        }

        .feature-icon {
            font-size: 30px;
            color: var(--primary-color);
            margin-bottom: 15px;
        }

        .feature-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .feature-description {
            font-size: 14px;
            color: var(--text-secondary);
        }

        /* Mobile responsive */
        .mobile-menu-toggle {
            display: none;
            background: none;
            border: none;
            color: var(--primary-color);
            font-size: 24px;
            cursor: pointer;
        }

        @media (max-width: 768px) {
            .mobile-menu-toggle {
                display: block;
            }

            .sidebar {
                position: fixed;
                left: 0;
                top: 0;
                height: 100%;
                z-index: 1000;
                transform: translateX(-100%);
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .chat-area {
                width: 100%;
            }

            .message-content {
                max-width: 85%;
            }

            .welcome-features {
                grid-template-columns: 1fr;
            }
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 215, 0, 0.3);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 215, 0, 0.5);
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="logo">
            <i class="fas fa-bolt"></i>
            <h1>ZestPay AI</h1>
        </div>
        <div class="header-actions">
            <button class="header-btn" onclick="exportChatHistory()">
                <i class="fas fa-download"></i>
                Export
            </button>
            <button class="header-btn" onclick="clearAllChats()">
                <i class="fas fa-trash"></i>
                Clear All
            </button>
            <button class="header-btn" onclick="window.location.href='/dashboard'">
                <i class="fas fa-home"></i>
                Dashboard
            </button>
        </div>
    </header>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h3><i class="fas fa-comments"></i> Chat History</h3>
                <button class="new-chat-btn" onclick="startNewChat()">
                    <i class="fas fa-plus"></i>
                    New Chat
                </button>
            </div>
            <div class="chat-history" id="chatHistory">
                <!-- Chat history items will be dynamically added here -->
            </div>
        </aside>

        <!-- Chat Area -->
        <main class="chat-area">
            <div class="chat-header">
                <button class="mobile-menu-toggle" onclick="toggleSidebar()">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="ai-avatar">
                    <i class="fas fa-robot"></i>
                </div>
                <div class="ai-info">
                    <div class="ai-name">ZestPay Assistant</div>
                    <div class="ai-status">
                        <span class="status-dot"></span>
                        Online - Ready to help
                    </div>
                </div>
            </div>

            <!-- Welcome Screen -->
            <div class="welcome-screen" id="welcomeScreen">
                <div class="welcome-avatar">
                    <i class="fas fa-robot"></i>
                </div>
                <h2 class="welcome-title">Welcome to ZestPay AI</h2>
                <p class="welcome-subtitle">
                    Your intelligent assistant for all ZestPay services. Ask me anything about payments, transactions, security, and more!
                </p>
                <div class="welcome-features">
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-question-circle"></i>
                        </div>
                        <div class="feature-title">Instant Answers</div>
                        <div class="feature-description">Get quick answers to your questions about ZestPay services</div>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <div class="feature-title">Security Help</div>
                        <div class="feature-description">Learn about security features and best practices</div>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="feature-title">Market Insights</div>
                        <div class="feature-description">Get real-time market data and analysis</div>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-history"></i>
                        </div>
                        <div class="feature-title">Chat History</div>
                        <div class="feature-description">Save and review your conversations anytime</div>
                    </div>
                </div>
            </div>

            <!-- Chat Messages -->
            <div class="chat-messages" id="chatMessages" style="display: none;">
                <!-- Messages will be dynamically added here -->
            </div>

            <!-- Quick Suggestions -->
            <div class="quick-suggestions" id="quickSuggestions">
                <div class="suggestion-chip" onclick="sendSuggestion('How do I send money?')">
                    💸 How do I send money?
                </div>
                <div class="suggestion-chip" onclick="sendSuggestion('What are the fees?')">
                    💰 What are the fees?
                </div>
                <div class="suggestion-chip" onclick="sendSuggestion('How secure is ZestPay?')">
                    🔒 How secure is ZestPay?
                </div>
                <div class="suggestion-chip" onclick="sendSuggestion('Current Bitcoin price')">
                    📈 Current Bitcoin price
                </div>
                <div class="suggestion-chip" onclick="sendSuggestion('How to enable 2FA?')">
                    🛡️ How to enable 2FA?
                </div>
            </div>

            <!-- Chat Input -->
            <div class="chat-input-container">
                <div class="chat-input-wrapper">
                    <textarea 
                        class="chat-input" 
                        id="chatInput" 
                        placeholder="Ask me anything about ZestPay..."
                        rows="1"
                        onkeydown="handleInputKeydown(event)"
                        oninput="autoResize(this)"
                    ></textarea>
                    <div class="chat-input-actions">
                        <button class="input-action-btn" onclick="attachFile()" title="Attach file">
                            <i class="fas fa-paperclip"></i>
                        </button>
                        <button class="input-action-btn" onclick="voiceInput()" title="Voice input">
                            <i class="fas fa-microphone"></i>
                        </button>
                        <button class="input-action-btn send-btn" id="sendBtn" onclick="sendMessage()" title="Send message">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // AI Assistant State Management
        const AIAssistant = {
            currentChatId: null,
            chats: [],
            isTyping: false,
            
            // Initialize the assistant
            init() {
                this.loadChats();
                this.renderChatHistory();
                this.setupEventListeners();
            },
            
            // Load chats from localStorage
            loadChats() {
                const savedChats = localStorage.getItem('zestpay_ai_chats');
                if (savedChats) {
                    this.chats = JSON.parse(savedChats);
                }
            },
            
            // Save chats to localStorage
            saveChats() {
                localStorage.setItem('zestpay_ai_chats', JSON.stringify(this.chats));
            },
            
            // Create a new chat
            createNewChat() {
                const chatId = 'chat_' + Date.now();
                const newChat = {
                    id: chatId,
                    title: 'New Chat',
                    messages: [],
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                
                this.chats.unshift(newChat);
                this.currentChatId = chatId;
                this.saveChats();
                this.renderChatHistory();
                this.showChatInterface();
                
                return newChat;
            },
            
            // Get current chat
            getCurrentChat() {
                return this.chats.find(chat => chat.id === this.currentChatId);
            },
            
            // Add message to current chat
            addMessage(role, content) {
                if (!this.currentChatId) {
                    this.createNewChat();
                }
                
                const chat = this.getCurrentChat();
                if (!chat) return;
                
                const message = {
                    id: 'msg_' + Date.now(),
                    role: role,
                    content: content,
                    timestamp: new Date().toISOString()
                };
                
                chat.messages.push(message);
                chat.updatedAt = new Date().toISOString();
                
                // Update chat title based on first user message
                if (role === 'user' && chat.messages.length === 1) {
                    chat.title = content.substring(0, 30) + (content.length > 30 ? '...' : '');
                }
                
                this.saveChats();
                this.renderChatHistory();
                this.renderMessage(message);
                
                return message;
            },
            
            // Render chat history in sidebar
            renderChatHistory() {
                const historyContainer = document.getElementById('chatHistory');
                
                if (this.chats.length === 0) {
                    historyContainer.innerHTML = `
                        <div style="text-align: center; color: var(--text-secondary); padding: 20px;">
                            <i class="fas fa-comments" style="font-size: 40px; margin-bottom: 10px; opacity: 0.5;"></i>
                            <p>No chat history yet</p>
                        </div>
                    `;
                    return;
                }
                
                historyContainer.innerHTML = this.chats.map(chat => `
                    <div class="chat-history-item ${chat.id === this.currentChatId ? 'active' : ''}" 
                         onclick="loadChat('${chat.id}')">
                        <i class="fas fa-trash chat-history-item-delete" onclick="deleteChat('${chat.id}', event)"></i>
                        <div class="chat-history-item-title">${chat.title}</div>
                        <div class="chat-history-item-date">${this.formatDate(chat.updatedAt)}</div>
                    </div>
                `).join('');
            },
            
            // Render a single message
            renderMessage(message) {
                const messagesContainer = document.getElementById('chatMessages');
                const messageElement = document.createElement('div');
                messageElement.className = `message ${message.role}`;
                messageElement.innerHTML = `
                    <div class="message-avatar">
                        <i class="fas fa-${message.role === 'ai' ? 'robot' : 'user'}"></i>
                    </div>
                    <div class="message-content">
                        <div class="message-text">${this.formatMessage(message.content)}</div>
                        <div class="message-time">${this.formatTime(message.timestamp)}</div>
                        <div class="message-actions">
                            <div class="message-action" onclick="copyMessage('${message.id}')" title="Copy">
                                <i class="fas fa-copy"></i>
                            </div>
                            <div class="message-action" onclick="regenerateResponse('${message.id}')" title="Regenerate">
                                <i class="fas fa-redo"></i>
                            </div>
                        </div>
                    </div>
                `;
                
                messagesContainer.appendChild(messageElement);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            },
            
            // Show typing indicator
            showTypingIndicator() {
                const messagesContainer = document.getElementById('chatMessages');
                const typingElement = document.createElement('div');
                typingElement.className = 'typing-indicator';
                typingElement.id = 'typingIndicator';
                typingElement.innerHTML = `
                    <div class="message-avatar">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="typing-dots">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                `;
                
                messagesContainer.appendChild(typingElement);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            },
            
            // Hide typing indicator
            hideTypingIndicator() {
                const typingIndicator = document.getElementById('typingIndicator');
                if (typingIndicator) {
                    typingIndicator.remove();
                }
            },
            
            // Generate AI response
            async generateResponse(userMessage) {
                this.showTypingIndicator();
                this.isTyping = true;
                
                // Simulate AI processing delay
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                // Generate contextual response
                const response = this.getAIResponse(userMessage);
                
                this.hideTypingIndicator();
                this.isTyping = false;
                
                // Add AI response to chat
                this.addMessage('ai', response);
            },
            
            // Get AI response based on user input
            getAIResponse(message) {
                const lowerMessage = message.toLowerCase();
                
                // Payment related queries
                if (lowerMessage.includes('send money') || lowerMessage.includes('transfer')) {
                    return `To send money with ZestPay:

1. Log in to your ZestPay account
2. Click on "Send Money" in the dashboard
3. Enter the recipient's email or phone number
4. Enter the amount and select currency
5. Review and confirm the transaction

The funds will be transferred instantly! For international transfers, delivery time may vary based on the destination country.`;
                }
                
                // Fee related queries
                if (lowerMessage.includes('fee') || lowerMessage.includes('cost')) {
                    return `ZestPay offers competitive fees:

💳 Domestic Transfers: 1.5% + $0.30
🌍 International Transfers: 2.5% + $0.50
💱 Currency Exchange: Real-time market rates + 0.5%
📱 Instant Transfers: Additional $0.25
🏦 Bank Withdrawals: $2.50 flat fee

Premium members enjoy 50% fee reduction on all transactions!`;
                }
                
                // Security related queries
                if (lowerMessage.includes('security') || lowerMessage.includes('safe')) {
                    return `ZestPay takes security seriously:

🔐 Bank-level 256-bit encryption
🛡️ Two-factor authentication (2FA)
🔍 Real-time fraud monitoring
🚫 Biometric authentication options
💳 PCI DSS compliant payment processing
📊 Regular security audits

Your funds are also FDIC insured up to $250,000. We recommend enabling 2FA for maximum security.`;
                }
                
                // 2FA related queries
                if (lowerMessage.includes('2fa') || lowerMessage.includes('two factor')) {
                    return `To enable Two-Factor Authentication:

1. Go to Settings → Security
2. Toggle on "Two-Factor Authentication"
3. Scan the QR code with your authenticator app
4. Enter the verification code
5. Save your backup codes securely

We support Google Authenticator, Authy, and other popular authenticator apps. Keep your backup codes safe - they're your only recovery option!`;
                }
                
                // Market/price related queries
                if (lowerMessage.includes('bitcoin') || lowerMessage.includes('btc') || lowerMessage.includes('price')) {
                    return `Current cryptocurrency prices (as of ${new Date().toLocaleTimeString()}):

🪙 Bitcoin (BTC): $43,256.78 (+2.34%)
💎 Ethereum (ETH): $2,234.56 (+1.87%)
🪙 Solana (SOL): $98.45 (+3.21%)
💎 Cardano (ADA): $0.58 (+0.92%)

Prices update every 30 seconds. You can buy, sell, and exchange these cryptocurrencies directly from your ZestPay dashboard!`;
                }
                
                // Account related queries
                if (lowerMessage.includes('account') || lowerMessage.includes('profile')) {
                    return `Your ZestPay account includes:

📊 Real-time transaction history
💰 Multi-currency wallet
📈 Portfolio tracking
🔔 Custom notifications
🎯 Spending insights
🏦 Linked bank accounts

You can upgrade to Premium for additional features like higher limits, priority support, and advanced analytics.`;
                }
                
                // Default response
                return `I'm here to help with your ZestPay questions! I can assist with:

💸 Sending and receiving money
💰 Transaction fees and limits
🔒 Security and privacy features
📈 Market rates and cryptocurrency
🏦 Account management
📱 Mobile app features

What would you like to know more about?`;
            },
            
            // Format message content (handle line breaks, links, etc.)
            formatMessage(content) {
                return content
                    .replace(/\n/g, '<br>')
                    .replace(/(https?:\/\/[^\s]+)/g, '<a href="$1" target="_blank" style="color: var(--primary-color);">$1</a>')
                    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                    .replace(/\*(.*?)\*/g, '<em>$1</em>');
            },
            
            // Format date
            formatDate(dateString) {
                const date = new Date(dateString);
                const now = new Date();
                const diffTime = Math.abs(now - date);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                
                if (diffDays === 1) return 'Today';
                if (diffDays === 2) return 'Yesterday';
                if (diffDays <= 7) return `${diffDays - 1} days ago`;
                
                return date.toLocaleDateString();
            },
            
            // Format time
            formatTime(dateString) {
                const date = new Date(dateString);
                return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            },
            
            // Show chat interface
            showChatInterface() {
                document.getElementById('welcomeScreen').style.display = 'none';
                document.getElementById('chatMessages').style.display = 'flex';
            },
            
            // Setup event listeners
            setupEventListeners() {
                // Auto-resize textarea
                const chatInput = document.getElementById('chatInput');
                chatInput.addEventListener('input', function() {
                    this.style.height = 'auto';
                    this.style.height = Math.min(this.scrollHeight, 120) + 'px';
                });
            }
        };
        
        // Global functions
        function startNewChat() {
            AIAssistant.createNewChat();
            document.getElementById('chatMessages').innerHTML = '';
            document.getElementById('chatInput').value = '';
            document.getElementById('chatInput').focus();
        }
        
        function loadChat(chatId) {
            AIAssistant.currentChatId = chatId;
            const chat = AIAssistant.chats.find(c => c.id === chatId);
            
            if (chat) {
                AIAssistant.showChatInterface();
                const messagesContainer = document.getElementById('chatMessages');
                messagesContainer.innerHTML = '';
                
                chat.messages.forEach(message => {
                    AIAssistant.renderMessage(message);
                });
                
                AIAssistant.renderChatHistory();
            }
        }
        
        function deleteChat(chatId, event) {
            event.stopPropagation();
            
            if (confirm('Are you sure you want to delete this chat?')) {
                AIAssistant.chats = AIAssistant.chats.filter(chat => chat.id !== chatId);
                
                if (AIAssistant.currentChatId === chatId) {
                    AIAssistant.currentChatId = null;
                    document.getElementById('welcomeScreen').style.display = 'flex';
                    document.getElementById('chatMessages').style.display = 'none';
                }
                
                AIAssistant.saveChats();
                AIAssistant.renderChatHistory();
            }
        }
        
        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message || AIAssistant.isTyping) return;
            
            // Add user message
            AIAssistant.addMessage('user', message);
            
            // Clear input
            input.value = '';
            input.style.height = 'auto';
            
            // Generate AI response
            AIAssistant.generateResponse(message);
        }
        
        function sendSuggestion(suggestion) {
            document.getElementById('chatInput').value = suggestion;
            sendMessage();
        }
        
        function handleInputKeydown(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }
        
        function autoResize(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = Math.min(textarea.scrollHeight, 120) + 'px';
        }
        
        function copyMessage(messageId) {
            const chat = AIAssistant.getCurrentChat();
            if (!chat) return;
            
            const message = chat.messages.find(m => m.id === messageId);
            if (message) {
                navigator.clipboard.writeText(message.content);
                showToast('Message copied to clipboard!');
            }
        }
        
        function regenerateResponse(messageId) {
            const chat = AIAssistant.getCurrentChat();
            if (!chat) return;
            
            const messageIndex = chat.messages.findIndex(m => m.id === messageId);
            if (messageIndex !== -1 && chat.messages[messageIndex].role === 'user') {
                // Remove all messages after this user message
                chat.messages = chat.messages.slice(0, messageIndex + 1);
                
                // Re-render messages
                const messagesContainer = document.getElementById('chatMessages');
                messagesContainer.innerHTML = '';
                chat.messages.forEach(msg => AIAssistant.renderMessage(msg));
                
                // Generate new response
                const userMessage = chat.messages[messageIndex].content;
                AIAssistant.generateResponse(userMessage);
            }
        }
        
        function exportChatHistory() {
            const dataStr = JSON.stringify(AIAssistant.chats, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `zestpay_ai_chats_${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showToast('Chat history exported successfully!');
        }
        
        function clearAllChats() {
            if (confirm('Are you sure you want to clear all chat history? This action cannot be undone.')) {
                AIAssistant.chats = [];
                AIAssistant.currentChatId = null;
                AIAssistant.saveChats();
                AIAssistant.renderChatHistory();
                
                document.getElementById('welcomeScreen').style.display = 'flex';
                document.getElementById('chatMessages').style.display = 'none';
                
                showToast('All chats cleared successfully!');
            }
        }
        
        function attachFile() {
            showToast('File attachment feature coming soon!');
        }
        
        function voiceInput() {
            showToast('Voice input feature coming soon!');
        }
        
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('open');
        }
        
        function showToast(message) {
            // Create toast element
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                bottom: 30px;
                right: 30px;
                background: rgba(26, 26, 26, 0.95);
                color: white;
                padding: 15px 20px;
                border-radius: 10px;
                border: 1px solid rgba(255, 215, 0, 0.3);
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
                z-index: 10000;
                animation: slideIn 0.3s ease;
            `;
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }
        
        // Add animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
        
        // Initialize AI Assistant when page loads
        document.addEventListener('DOMContentLoaded', () => {
            AIAssistant.init();
        });
    </script>
</body>
</html>